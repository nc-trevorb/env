# unbind everything, including tmux builtins
unbind-key -a
unbind-key -T copy-mode -a
unbind-key -T copy-mode-vi -a

## options ##
#############
set -g default-terminal "screen-256color"
set -g base-index 1 # start window numbering at 1
set -g pane-base-index 1 # start pane numbering at 1
set -g history-limit 10000
set -s escape-time 0

set -g prefix C-q
# bind-key C-q send-prefix

## status bar appearance ##
###########################

# [ battery ] [ date/time ]
# linux
# set -g status-right "#[fg=white bg=black]#(acpi | awk -F, '{print $2}') #[bg=default] #[bg=black] %a, %b %d #[bg=default] #[bg=black] %I:%M %p #[default]#[fg=colour245]  "

# openbsd
set -g status-right " #[fg=red][#[fg=white] #(apm -l)%% #[fg=red]]#[default] #[fg=red][#[fg=white] %a, %b %d -- %I:%M %p #[fg=red]]#[default] "

# macos
# set -g status-right " #[fg=red][#[fg=white] #(pmset -g batt | tr '\t' '\n' | sed -e '3!d' -e 's/;.*//') #[fg=red]]#[default] #[fg=red][#[fg=white] %a, %b %d -- %I:%M %p #[fg=red]]#[default] "

set-option -g status-style bg=colour8,fg=white

set-window-option -g window-status-format ' #[underscore]|#I#[default]  #W '
set-window-option -g window-status-style fg=white

set-window-option -g window-status-current-format ' #[bg=default,underscore]|#I  #W#[default] '
set-window-option -g window-status-current-style fg=colour196

set -g pane-active-border-style fg=colour196

set-option -g status-keys emacs
set-window-option -g mode-keys vi


## keybindings ##
#################

# reload tmux config file
bind C-r source ~/.tmux.conf \; display-message 'reloaded conf'

# FIXME: $PWD/pane_current_path isn't working on openbsd
bind c new-window -c "${pane_current_path}"
bind - split-window -v -c "${pane_current_path}"
bind _ split-window -v -c "${pane_current_path}"
bind \ split-window -h -c "${pane_current_path}"
bind | split-window -h -c "${pane_current_path}"

bind : command-prompt
bind ? list-keys
bind q display-panes

bind , command-prompt -I "#W" "rename-window -- '%%'"
bind . command-prompt "move-window -t '%%'"

bind h select-pane -L
bind n select-pane -D
bind e select-pane -U
bind i select-pane -R

bind C-h select-pane -L
bind C-n select-pane -D
bind C-e select-pane -U
bind C-i select-pane -R

bind -r H resize-pane -L 5
bind -r N resize-pane -D 5
bind -r E resize-pane -U 5
bind -r I resize-pane -R 5

bind C-q last-window

bind o last-pane
bind C-o last-pane

bind z resize-pane -Z
bind C-z resize-pane -Z

# run previous command in last pane
bind C-t last-pane \; send-keys C-l 'Up' 'Enter' \; last-pane

# sync system time (openbsd)
bind T new-window -n 'syncing time...' -d sudo ntpd -s

bind ! select-window -t 1
bind @ select-window -t 2
bind '#' select-window -t 3
bind '$' select-window -t 4
bind % select-window -t 5
bind ^ select-window -t 6
bind & select-window -t 7
bind * select-window -t 8
bind ( select-window -t 9


## copy mode keybindings ##
###########################
bind s copy-mode \; send-keys -X start-of-line

bind p paste-buffer
bind C-v send-keys C-x C-v # copy emacs region
bind C-y paste-buffer -b emacsclip

bind-key -T copy-mode-vi N send-keys -X page-down
bind-key -T copy-mode-vi n send-keys -X scroll-down
bind-key -T copy-mode-vi e send-keys -X scroll-up
bind-key -T copy-mode-vi E send-keys -X page-up

bind-key -T copy-mode-vi H send-keys -X start-of-line
bind-key -T copy-mode-vi I send-keys -X end-of-line

bind-key -T copy-mode-vi g send-keys -X history-top
bind-key -T copy-mode-vi G send-keys -X history-bottom

bind-key -T copy-mode-vi C-h send-keys -X cursor-left
bind-key -T copy-mode-vi C-n send-keys -X cursor-down
bind-key -T copy-mode-vi C-e send-keys -X cursor-up
bind-key -T copy-mode-vi C-i send-keys -X cursor-right

bind-key -T copy-mode-vi M-h send-keys -X previous-word
bind-key -T copy-mode-vi M-n send-keys -X next-paragraph
bind-key -T copy-mode-vi M-e send-keys -X previous-paragraph
bind-key -T copy-mode-vi M-i send-keys -X next-space-end

bind-key -T copy-mode-vi q send-keys -X cancel

bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind-key -T copy-mode-vi o send-keys -X other-end

bind-key -T copy-mode-vi ? command-prompt -p "(search up)" "send -X search-backward \"%%%\""
bind-key -T copy-mode-vi / command-prompt -p "(search down)" "send -X search-forward \"%%%\""
bind-key -T copy-mode-vi C-s send-keys -X search-again
bind-key -T copy-mode-vi C-r send-keys -X search-reverse

bind-key -T copy-mode-vi M send-keys -X middle-line
