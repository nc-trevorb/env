# unbind everything, including tmux builtins
unbind-key -a
unbind-key -T copy-mode -a
unbind-key -T copy-mode-vi -a

## options ##
#############
set -g default-terminal "screen-256color"
set -g base-index 1 # start window numbering at 1
set -g pane-base-index 1 # start pane numbering at 1
set -g history-limit 10000
set -s escape-time 0

set -g prefix C-q
bind-key C-q send-prefix

## status bar appearance ##
###########################

# [ battery ] [ date/time ]
# linux
# set -g status-right "#[fg=white bg=black]#(acpi | awk -F, '{print $2}') #[bg=default] #[bg=black] %a, %b %d #[bg=default] #[bg=black] %I:%M %p #[default]#[fg=colour245]  "

# openbsd
set -g status-right " #[fg=red][#[fg=white] #(apm -l)%% #[fg=red]]#[default] #[fg=red][#[fg=white] %a, %b %d -- %I:%M %p #[fg=red]]#[default] "

# macos
# set -g status-right " #[fg=red][#[fg=white] #(pmset -g batt | tr '\t' '\n' | sed -e '3!d' -e 's/;.*//') #[fg=red]]#[default] #[fg=red][#[fg=white] %a, %b %d -- %I:%M %p #[fg=red]]#[default] "

set-option -g status-style bg=colour8,fg=white

set-window-option -g window-status-format ' #[underscore]|#I#[default]  #W '
set-window-option -g window-status-style fg=white

set-window-option -g window-status-current-format ' #[bg=default,underscore]|#I  #W#[default] '
set-window-option -g window-status-current-style fg=colour196

set -g pane-active-border-style fg=colour196

set-option -g status-keys emacs
set-window-option -g mode-keys vi


## keybindings ##
#################

# reload tmux config file
bind C-r source ~/.tmux.conf \; display-message 'reloaded conf'

# FIXME: $PWD/pane_current_path isn't working on openbsd
bind c new-window -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind _ split-window -v -c "#{pane_current_path}"
bind \ split-window -h -c "#{pane_current_path}"
bind | split-window -h -c "#{pane_current_path}"

bind M-h split-window -h -c "#{pane_current_path}" \; swap-pane -U
bind M-n split-window -v -c "#{pane_current_path}"
bind M-e split-window -v -c "#{pane_current_path}" \; swap-pane -U
bind M-i split-window -h -c "#{pane_current_path}"

bind : command-prompt
bind ? list-keys
bind q display-panes

bind r command-prompt -I "#W" "rename-window -- '%%'"
bind m command-prompt "move-window -t '%%'"

bind h select-pane -L
bind n select-pane -D
bind e select-pane -U
bind i select-pane -R

bind C-h select-pane -L
bind C-n select-pane -D
bind C-e select-pane -U
bind M-! select-pane -R

bind -r H resize-pane -L 5
bind -r N resize-pane -D 5
bind -r E resize-pane -U 5
bind -r I resize-pane -R 5

bind w resize-pane -Z
bind C-w resize-pane -Z

# run previous command in last pane
bind Enter last-pane \; send-keys C-l 'Up' 'Enter' \; last-pane

bind -r C-l previous-window
bind -r C-y next-window
bind -r l previous-window
bind -r y next-window

# sync system time (openbsd)
bind T new-window -n 'syncing time...' -d sudo ntpd -s


## copy mode keybindings ##
###########################
bind s copy-mode \; send-keys -X start-of-line
# bind C-s copy-mode \; send-keys -X start-of-line

bind p paste-buffer
bind C-p paste-buffer
# bind C-v send-keys C-x C-v # copy emacs region
# bind C-y paste-buffer -b emacsclip

bind-key -T copy-mode-vi H send-keys -X page-up
bind-key -T copy-mode-vi N send-keys -X scroll-down
bind-key -T copy-mode-vi E send-keys -X scroll-up
bind-key -T copy-mode-vi I send-keys -X page-down

bind-key -T copy-mode-vi - send-keys -X end-of-line

bind-key -T copy-mode-vi < send-keys -X history-top
bind-key -T copy-mode-vi > send-keys -X history-bottom

bind-key -T copy-mode-vi h send-keys -X cursor-left
bind-key -T copy-mode-vi n send-keys -X cursor-down
bind-key -T copy-mode-vi e send-keys -X cursor-up
bind-key -T copy-mode-vi i send-keys -X cursor-right

bind-key -T copy-mode-vi z send-keys -X start-of-line
bind-key -T copy-mode-vi k send-keys -X start-of-line \; send-keys -X next-word
bind-key -T copy-mode-vi l send-keys -X previous-word
bind-key -T copy-mode-vi L send-keys -X previous-space
bind-key -T copy-mode-vi o send-keys -X next-word-end
bind-key -T copy-mode-vi O send-keys -X next-space-end
bind-key -T copy-mode-vi y send-keys -X next-word
bind-key -T copy-mode-vi Y send-keys -X next-space

bind-key -T copy-mode-vi . send-keys -X page-down
bind-key -T copy-mode-vi , send-keys -X page-up

bind-key -T copy-mode-vi q send-keys -X cancel
bind-key -T copy-mode-vi C-g send-keys -X cancel

bind-key -T copy-mode-vi s send-keys -X begin-selection
bind-key -T copy-mode-vi c send-keys -X copy-selection-and-cancel
bind-key -T copy-mode-vi C-o send-keys -X other-end

bind-key -T copy-mode-vi M command-prompt -p "(search up)" "send -X search-backward \"%%%\""
bind-key -T copy-mode-vi m command-prompt -p "(search down)" "send -X search-forward \"%%%\""
bind-key -T copy-mode-vi M-m send-keys -X search-again
bind-key -T copy-mode-vi M-M send-keys -X search-reverse

# bind-key -T copy-mode-vi C-l send-keys -X middle-line
